<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <title>Ruleta Personalitzable</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/winwheel@2.7.0/dist/Winwheel.min.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; }
        .option-input { margin: 5px 0; }
    </style>
</head>
<body>

    <h1>Ruleta Personalitzable</h1>

    <!-- Formulario para opciones -->
    <form id="optionsForm">
        <label for="numOptions">Número d'opcions:</label>
        <input type="number" id="numOptions" name="numOptions" min="2" max="20" value="4">
        <button type="button" onclick="generateOptionInputs()">Crear opcions</button>
        <div id="optionsContainer"></div>
        <button type="submit">Crear ruleta</button>
    </form>

    <br><br>

    <!-- Ruleta -->
    <canvas id="canvas" width="500" height="500"></canvas><br>
    <button onclick="startSpin()">SPIN</button>
    <button onclick="resetWheel()">Reiniciar</button>

    <script>
        let theWheel;

        function generateOptionInputs() {
            const container = document.getElementById("optionsContainer");
            const num = parseInt(document.getElementById("numOptions").value);
            container.innerHTML = "";
            for (let i = 0; i < num; i++) {
                const input = document.createElement("input");
                input.type = "text";
                input.placeholder = "Opció " + (i + 1);
                input.className = "option-input";
                input.required = true;
                container.appendChild(input);
                container.appendChild(document.createElement("br"));
            }
        }

        document.getElementById("optionsForm").addEventListener("submit", function (e) {
            e.preventDefault();
            const inputs = document.querySelectorAll("#optionsContainer input");
            const segments = Array.from(inputs).map((input, index) => {
                const colors = ['#72b027', '#265213', '#3358ed', '#b02773', '#ede433'];
                return {
                    text: input.value,
                    fillStyle: colors[index % colors.length],
                    textFillStyle: '#FFFFFF'
                };
            });

            theWheel = new Winwheel({
                numSegments: segments.length,
                outerRadius: 200,
                textFontSize: 20,
                segments: segments,
                animation: {
                    type: 'spinToStop',
                    duration: 5,
                    spins: 8,
                    callbackFinished: alertPrize
                }
            });
        });

        function startSpin() {
            if (theWheel) theWheel.startAnimation();
        }

        function resetWheel() {
            if (theWheel) {
                theWheel.stopAnimation(false);
                theWheel.rotationAngle = 0;
                theWheel.draw();
            }
        }

        function alertPrize(indicatedSegment) {
            alert("Has guanyat: " + indicatedSegment.text + "!");
        }

        // Inicializa con inputs por defecto
        window.onload = generateOptionInputs;
    </script>

</body>
</html>
