<!DOCTYPE html>
<html xml:lang="ca" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="content-type" content="text/html; charset=windows-1252">
<title>Ruleta Codelearn</title>
<link rel="stylesheet" href="assets/main.css" type="text/css">
<script type="text/javascript" src="assets/Winwheel.js"></script>
<script src="assets/TweenMax.min.js"></script>
</head>
<body>
<div id="wheelogo" align="left">
    <img src="assets/codelearnlogo-fonblanc.jpg" width="400" height="125" alt="Logo">
</div>
<br><br>
<div align="center">
    <button onclick="toggleMode()">Canviar Mode</button>
    <table cellpadding="0" cellspacing="0" border="0">
        <tr>
            <td colspan="2" align="center">
                <h1 style="background-color:#72b027; color:white">RULETA</h1>
                <h1>Ruleta <b>Code<font color="#72b027">learn</font></b> - Castelldefels/Gavà/Viladecans</h1>
                <h2><span style="color: DarkRed;">3 exercicis a casa, <u>no acumulable</u></span></h2>
                <p>Escull la potència de la ruleta i fes clic a <b>SPIN</b></p>
            </td>
        </tr>
        <tr>
            <td>
                <div class="power_controls">
                    <table class="power" cellpadding="10" cellspacing="0">
                        <tr><th align="center">Potència</th></tr>
                        <tr><td width="78" align="center" id="pw3" onclick="powerSelected(3);">Alta</td></tr>
                        <tr><td align="center" id="pw2" onclick="powerSelected(2);">Mitjana</td></tr>
                        <tr><td align="center" id="pw1" onclick="powerSelected(1);">Baixa</td></tr>
                    </table>
                    <br>
                    <img id="spin_button" src="assets/spin_off.png" alt="Spin" onclick="startSpin();">
                    <br><br>
                    &nbsp;<a href="#" onclick="resetWheel(); return false;">Tornar a jugar</a>
                </div>
            </td>
            <td width="438" height="582" class="the_wheel" align="center" valign="center">
                <canvas id="canvas" width="434" height="434">
                    <p style="color: white" align="center">Sorry, your browser doesn't support canvas. Please try another.</p>
                </canvas>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <img src="assets/display.bons.png" alt="Personatges">
            </td>
        </tr>
    </table>
</div>

<script>
const segmentsSet1 = [
    { fillStyle: '#265213', text: '+400 punts', textFillStyle: '#FFFFFF', size: 20, textFontSize: 22 },
    { fillStyle: '#3358ed', text: '+75 punts', textFillStyle: '#FFFFFF' },
    { fillStyle: '#b02773', text: '+100 punts', textFillStyle: '#FFFFFF' },
    { fillStyle: '#72b027', text: '+200 punts', textFillStyle: '#FFFFFF', size: 35 },
    { fillStyle: '#b02773', text: '+100 punts', textFillStyle: '#FFFFFF' },
    { fillStyle: '#ede433', text: '+150 punts' },
    { fillStyle: '#b02773', text: '+100 punts', textFillStyle: '#FFFFFF' },
    { fillStyle: '#3358ed', text: '+75 punts', textFillStyle: '#FFFFFF' }
];

const segmentsSet2 = [
    { fillStyle: '#ff5733', text: 'Premi sorpresa' },
    { fillStyle: '#33c1ff', text: '5 min extra' },
    { fillStyle: '#33ff88', text: 'Recompensa dolça' },
    { fillStyle: '#d633ff', text: 'Pista extra' },
    { fillStyle: '#ffd433', text: 'Joc nou' },
    { fillStyle: '#ff3333', text: 'Reptes especials' },
    { fillStyle: '#33ffcc', text: 'Mini joc' },
    { fillStyle: '#3399ff', text: 'Tria un premi' }
];

let currentMode = 1;
let wheelPower = 0;
let wheelSpinning = false;

let theWheel = new Winwheel({
    'numSegments': segmentsSet1.length,
    'outerRadius': 212,
    'textFontSize': 24,
    'textAlignment': 'center',
    'innerRadius': 20,
    'rotationAngle': -10,
    'segments': segmentsSet1,
    'animation': {
        'type': 'spinToStop',
        'duration': 5,
        'spins': 8,
        'callbackFinished': alertPrize
    }
});

function powerSelected(powerLevel) {
    if (!wheelSpinning) {
        document.getElementById('pw1').className = "";
        document.getElementById('pw2').className = "";
        document.getElementById('pw3').className = "";

        if (powerLevel >= 1) document.getElementById('pw1').className = "pw1";
        if (powerLevel >= 2) document.getElementById('pw2').className = "pw2";
        if (powerLevel >= 3) document.getElementById('pw3').className = "pw3";

        wheelPower = powerLevel;
        document.getElementById('spin_button').src = "assets/spin_on.png";
        document.getElementById('spin_button').className = "clickable";
    }
}

function startSpin() {
    if (!wheelSpinning) {
        theWheel.animation.spins = wheelPower === 1 ? 3 : wheelPower === 2 ? 8 : 15;
        document.getElementById('spin_button').src = "assets/spin_off.png";
        document.getElementById('spin_button').className = "";
        theWheel.startAnimation();
        wheelSpinning = true;
    }
}

function resetWheel() {
    theWheel.stopAnimation(false);
    theWheel.rotationAngle = 0;
    theWheel.draw();
    document.getElementById('pw1').className = "";
    document.getElementById('pw2').className = "";
    document.getElementById('pw3').className = "";
    wheelSpinning = false;
}

function alertPrize(indicatedSegment) {
    alert("Has guanyat: " + indicatedSegment.text + " !!!!!");
}

function toggleMode() {
    if (wheelSpinning) return alert('Has de parar la ruleta abans de canviar!');
    currentMode = currentMode === 1 ? 2 : 1;
    const selectedSegments = currentMode === 1 ? segmentsSet1 : segmentsSet2;
    setWheelSegments(selectedSegments);
}

function setWheelSegments(segments) {
    theWheel.segments = [];
    segments.forEach(segment => theWheel.addSegment(segment));
    theWheel.numSegments = segments.length;
    theWheel.draw();
}
</script>
</body>
</html>
